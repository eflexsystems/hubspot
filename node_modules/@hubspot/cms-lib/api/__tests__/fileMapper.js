const fileStreamResponse = require('./fixtures/fileStreamResponse');
const { createFileMapperNodeStreamTransform } = require('../fileMapper');

describe('cms-lib/api/fileMapper', () => {
  describe('createFileMapperNodeStreamTransform()', () => {
    const src = '1234/test.html';
    it('should return request#tranform function', () => {
      const transform = createFileMapperNodeStreamTransform(src);
      expect(typeof transform).toBe('function');
    });
    it('should return request#tranform to create a FileMapperNode from the octet-stream response', () => {
      const node = createFileMapperNodeStreamTransform(src)(
        fileStreamResponse.body,
        fileStreamResponse
      );
      expect(node).toEqual({
        source:
          '<!--\n    templateType: page\n    isAvailableForNewContent: false\n-->\n<div>\n\thello new stuff\n\thello new stuff\n\thello new stuff\n</div>\n',
        path: '/1234/test.html',
        createdAt: 0,
        updatedAt: 1565214001268,
        name: 'test.html',
        folder: false,
        children: [],
      });
    });
  });
});
